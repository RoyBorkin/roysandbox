<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Hexagonal Shape with Hole</title>
    <script type="module">
        import * as THREE from './js/three.module.js';  // Use local path for three.js
        import { CSG } from './js/three-csg.js';  // Use local path for three-csg.js

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Initialize OrbitControls
        const controls = new THREE.OrbitControls(camera, renderer.domElement);

        let hexagonalShape;
        let height = 10;
        let segments = 6;
        let diameter = 10;

        // Function to create a hexagonal shape with a hole in the center using CSG
        function createHexagonalShape() {
            // Remove existing shape if it exists
            if (hexagonalShape) scene.remove(hexagonalShape);

            const radius = diameter / 2;
            
            // Create the outer hexagonal cylinder
            const geometryA = new THREE.CylinderGeometry(radius, radius, height, segments);
            const materialA = new THREE.MeshBasicMaterial({ color: Math.random() * 0xffffff });
            const meshA = new THREE.Mesh(geometryA, materialA);

            // Create the inner cylinder (hole)
            const geometryB = new THREE.CylinderGeometry(radius / 2, radius / 2, height, segments);
            const materialB = new THREE.MeshBasicMaterial({ color: 0x000000 });
            const meshB = new THREE.Mesh(geometryB, materialB);

            // Perform subtraction (create hole)
            const csgA = CSG.fromMesh(meshA);
            const csgB = CSG.fromMesh(meshB);
            const result = CSG.subtract(csgA, csgB);  // Subtract mesh B from mesh A

            // Convert back to mesh and add to the scene
            const resultMesh = CSG.toMesh(result, materialA);
            scene.add(resultMesh);
            hexagonalShape = resultMesh;
        }

        // Function to update parameters and regenerate the hexagonal shape
        function updateShape() {
            height = parseFloat(document.getElementById("height").value);
            segments = parseInt(document.getElementById("segments").value);
            diameter = parseFloat(document.getElementById("diameter").value);

            createHexagonalShape(); // Update the shape with the new parameters
        }

        // Export the model as OBJ
        function exportOBJ() {
            const exporter = new THREE.OBJExporter();
            const objData = exporter.parse(scene);

            const blob = new Blob([objData], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'hexagonal_shape_with_hole.obj'; // Download filename
            link.click(); // Trigger the download
        }

        // Set initial scene and camera position
        camera.position.z = 30;

        // Animate the scene
        function animate() {
            requestAnimationFrame(animate);
            controls.update(); // Update controls (needed for smooth interaction)
            renderer.render(scene, camera);
        }
        animate();

        // Initialize the hexagonal shape with default parameters
        createHexagonalShape();
    </script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
        #controls { position: absolute; top: 10px; left: 10px; background: rgba(255, 255, 255, 0.7); padding: 10px; border-radius: 5px; }
        input { margin: 5px; }
        button { margin-top: 10px; }
    </style>
</head>
<body>
    <div id="controls">
        <h3>Hexagonal Shape Parameters</h3>
        <label for="height">Height:</label>
        <input type="number" id="height" value="10" min="1" max="50" step="1"><br>
        <label for="segments">Segments (Number of Sides):</label>
        <input type="number" id="segments" value="6" min="3" max="12" step="1"><br>
        <label for="diameter">Diameter:</label>
        <input type="number" id="diameter" value="10" min="1" max="50" step="1"><br>
        <button onclick="updateShape()">Update Shape</button><br>
        <button onclick="exportOBJ()">Export OBJ</button>
    </div>
</body>
</html>
